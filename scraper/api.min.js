const express=require("express"),app=express(),{Pool:Pool}=require("pg"),fetch=require("node-fetch");app.use(express.json());let pool=new Pool({user:"postgres",password:"password",host:"localhost",port:5432,database:"realtime"});const port=8070;var count=32;async function start(){try{for(await pool.connect(),await pool.query("CREATE TABLE users(\n            useremail VARCHAR,\n            name VARCHAR,\n            password VARCHAR,\n            PRIMARY KEY(useremail)\t\n        )"),await pool.query("CREATE TABLE questions(\n            question VARCHAR,\n            correctanswer VARCHAR,\n            option1 VARCHAR,\n            option2 VARCHAR,\n            PRIMARY KEY(question)\n        )"),await pool.query("CREATE TABLE leaderboard(\n            attemptnumber INT,\n            nickname VARCHAR,\n            date VARCHAR,\n            numbercorrect INT,\n            improvement INT,\n            PRIMARY KEY(attemptnumber, nickname)\t\n        )"),await pool.query("INSERT INTO users (useremail, name, password) values ('test1email', 'test1name', 'testpass')"),await pool.query("INSERT INTO leaderboard (attemptnumber, nickname, date, numbercorrect, improvement) values (1, 'test1name', '2021-08-12', 5, 0)"),i=1;i<33;i++)for(console.log(`Countdown ${count}`),count--,p=0;p<3;p++)0==p?await fetch(`https://opentdb.com/api.php?amount=50&category=${i}&difficulty=easy&type=multiple`).then(function(t){return t.json()}).then(async function(e){for(t=0;t<e.results.length;t++){var n=e.results[t].question,o=e.results[t].correct_answer,s=e.results[t].incorrect_answers[0],r=e.results[t].incorrect_answers[1];await pool.query("insert into questions (question, correctanswer, option1, option2) values ($1, $2, $3, $4)",[`${n}`,`${o}`,`${s}`,`${r}`])}}):1==p?await fetch(`https://opentdb.com/api.php?amount=50&category=${i}&difficulty=medium&type=multiple`).then(function(t){return t.json()}).then(async function(e){for(t=0;t<e.results.length;t++){var n=e.results[t].question,o=e.results[t].correct_answer,s=e.results[t].incorrect_answers[0],r=e.results[t].incorrect_answers[1];await pool.query("insert into questions (question, correctanswer, option1, option2) values ($1, $2, $3, $4)",[`${n}`,`${o}`,`${s}`,`${r}`])}}):await fetch(`https://opentdb.com/api.php?amount=50&category=${i}&difficulty=hard&type=multiple`).then(function(t){return t.json()}).then(async function(e){for(t=0;t<e.results.length;t++){var n=e.results[t].question,o=e.results[t].correct_answer,s=e.results[t].incorrect_answers[0],r=e.results[t].incorrect_answers[1];await pool.query("insert into questions (question, correctanswer, option1, option2) values ($1, $2, $3, $4)",[`${n}`,`${o}`,`${s}`,`${r}`])}});console.log("Fetching Has Now Finished")}catch(t){console.log(t)}}start(),app.listen(8070,()=>{console.log("server started on port 8070")});